<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drag & Drop Stack Game</title>
<style>
  body {
    margin:0;
    background:#222;
    font-family:sans-serif;
    /* overflow:hidden; */
  }
  h3,p {
    margin-top: 8px;
    margin-bottom: 8px;
    color: #fff;
  }
  .game_body{
    display: flex;
  }
  .header{
   
   text-align: left;
   color:#fff

  }
  .header p{
    margin-bottom: 8px;
    font-size: 0.75rem;
  }
   .header h4{
    margin-bottom: 0px;
    margin-top: 0px;
    font-size: 1rem;
    line-height: 10px;
   
  }
  /* ----- Left palette ----- */
  #palette {
    width:150px;
    background:#111;
    padding:10px;
    box-sizing:border-box;
    color:#fff;
  }
  .shape {
    background:#374d9d;
    margin:12px auto;
    cursor:grab;
  }
  /* ----- Right game area ----- */
  #gameWrapper {
    flex:1;
    position:relative;
  }
  #hud {
    position:absolute;
    top:10px;
    left:10px;
    font-size:20px;
    color:#fff;
    z-index:10;
  }
  #restart {
    margin-left:20px;
    padding:6px 14px;
    font-size:0.8rem;
    cursor:pointer;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    color: #374d9d;
  }
  #restart:hover {
    background-color: #374d9d;
    border: 1px solid #fff;
    color: #fff;
  }
  canvas {
    display:block;
    background:#4174cf;  /* game canvas background */
  }
  .w-75{
    width: 75%;
    padding: 24px;
  }
  .gameCanvas{
    width: calc('90%-150px');
    height: 600px;
  }
</style>
</head>
<body>
    
<div class="game_body">
    <!-- Shape Palette -->
<div id="palette">
  <p>Choose Shapes</p>
  <div class="shape" style="width:100px;height:40px;"></div>
  <div class="shape" style="width:80px;height:50px;"></div>
  <div class="shape" style="width:120px;height:30px;"></div>
  <div class="shape" style="width:20px;height:60px;"></div>
  <div class="shape" style="width:40px;height:40px;"></div>
</div>

<!-- Game Area -->
<div id="gameWrapper">
  <div id="hud">
    <div class="header">
         <h4>How many blocks can you Stack ?  </h4>
         <p>Drop the blocks on the right, onto the darker blue rectangles</p>
    </div>
    Score: <span id="score">0</span>
    <button id="restart">Restart</button>
  </div>
  <canvas id="gameCanvas" class="gameCanvas"  ></canvas>
</div>

</div>

<div class="w-75">
    <h3 class="post_header">Stack Physics Stacking Puzzle</h3>
<p>Teach kids about the laws of physics by seeing how many blocks of varying shapes and sizes can be stacked without falling over.  Fun for grownups too!  Teachers trust Toy Theater to provide safe & effective educational games. Free to play, priceless for learning.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
 const { Engine, Render, Runner, World, Bodies, Events } = Matter;

const canvas  = document.getElementById('gameCanvas');
const wrapper = document.getElementById('gameWrapper');
const scoreEl = document.getElementById('score');
const restart = document.getElementById('restart');

const engine = Engine.create();
engine.world.gravity.y = 1;

function resize() {
  canvas.width  = wrapper.clientWidth;
  canvas.height = wrapper.clientHeight;
}
window.addEventListener('resize', resize);
resize();

const render = Render.create({
  canvas,
  engine,
  options: { wireframes:false, background:'#4174cf' }
});
Render.run(render);
Runner.run(Runner.create(), engine);

const world = engine.world;

/* ---------- Static walls ---------- */
const wallColor = '#11182a';
let platform, leftWall, rightWall;
function addWalls(){
  const w = canvas.width, h = canvas.height;
  const pw = w*0.60;
  platform = Bodies.rectangle(w/2, h-20, pw, 20, {isStatic:true, render:{fillStyle:wallColor}});
  leftWall  = Bodies.rectangle(-10, h/2, 20, h, {isStatic:true, render:{fillStyle:wallColor}});
  rightWall = Bodies.rectangle(w+10, h/2, 20, h, {isStatic:true, render:{fillStyle:wallColor}});
  World.add(world,[platform,leftWall,rightWall]);
}
addWalls();

/* ---------- Scoring ---------- */
let score = 0;
Events.on(engine,'collisionStart',e=>{
  e.pairs.forEach(p=>{
    const a=p.bodyA,b=p.bodyB;
    if ((a===platform&&!b.isStatic)||(b===platform&&!a.isStatic)){
      const box=a===platform?b:a;
      if(!box.scored){ score++; box.scored=true; scoreEl.textContent=score; }
    }
  });
});
Events.on(engine,'afterUpdate',()=>{
  world.bodies.forEach(b=>{
    if(!b.isStatic && b.position.y>canvas.height+50){
      if(!b.missed){ score=Math.max(0,score-1); b.missed=true; scoreEl.textContent=score; }
      World.remove(world,b);
    }
  });
});

/* ---------- Create a physics box ---------- */
function addBox(x,y,w,h){
  const box = Bodies.rectangle(x,y,w,h,{
    restitution:0.2,
    friction:0.8,
    density:0.001,
    render:{fillStyle:'#374d9d'}
  });
  World.add(world, box);
}

/* ---------- Custom drag-and-drop ---------- */
let dragData = null;
const shapes = document.querySelectorAll('.shape');

shapes.forEach(shape=>{
  shape.addEventListener('pointerdown', e=>{
    e.preventDefault();
    dragData = {
      el: shape,
      w: shape.offsetWidth,
      h: shape.offsetHeight
    };
    shape.setPointerCapture(e.pointerId);
  });

  shape.addEventListener('pointermove', e=>{
    if(!dragData) return;
    shape.style.position='relative';
    shape.style.zIndex=1000;
    shape.style.left = (e.clientX - dragData.w/2) + 'px';
    shape.style.top  = (e.clientY - dragData.h/2) + 'px';
  });

  shape.addEventListener('pointerup', e=>{
    if(!dragData) return;
    const rect = canvas.getBoundingClientRect();
    if (e.clientX >= rect.left && e.clientX <= rect.right &&
        e.clientY >= rect.top  && e.clientY <= rect.bottom) {
      // drop inside canvas
      addBox(e.clientX - rect.left, e.clientY - rect.top,
             dragData.w, dragData.h);
    }
    // reset style
    dragData.el.style.position='';
    dragData.el.style.left='';
    dragData.el.style.top='';
    dragData = null;
  });
});

/* ---------- Restart ---------- */
restart.addEventListener('pointerdown',()=>{
  World.clear(world,true);
  score = 0;
  scoreEl.textContent = score;
  addWalls();
});
</script>
</body>
</html>

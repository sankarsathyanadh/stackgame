<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drag & Drop Stack Game</title>
<style>
  body {
    margin:0;
    background:#222;
    font-family:sans-serif;
    /* overflow:hidden; */
  }
  h3,p {
    margin-top: 8px;
    margin-bottom: 8px;
    color: #fff;
  }
  .game_body{
    display: flex;
  }
  .header{
   
   text-align: left;
   color:#fff

  }
  .header p{
    margin-bottom: 8px;
    font-size: 0.75rem;
  }
   .header h4{
    margin-bottom: 0px;
    margin-top: 0px;
    font-size: 1rem;
    line-height: 10px;
   
  }
  /* ----- Left palette ----- */
  #palette {
    width:150px;
    background:#111;
    padding:10px;
    box-sizing:border-box;
    color:#fff;
  }
  .shape {
    background:#374d9d;
    margin:12px auto;
    cursor:grab;
  }
  /* ----- Right game area ----- */
  #gameWrapper {
    flex:1;
    position:relative;
  }
  #hud {
    position:absolute;
    top:10px;
    left:10px;
    font-size:20px;
    color:#fff;
    z-index:10;
  }
  #restart {
    margin-left:20px;
    padding:6px 14px;
    font-size:0.8rem;
    cursor:pointer;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    color: #374d9d;
  }
  #restart:hover {
    background-color: #374d9d;
    border: 1px solid #fff;
    color: #fff;
  }
  canvas {
    display:block;
    background:#4174cf;  /* game canvas background */
  }
  .w-75{
    width: 75%;
    padding: 24px;
  }
  .gameCanvas{
    width: calc('90%-150px');
    height: 600px;
  }
</style>
</head>
<body>
    
<div class="game_body">
    <!-- Shape Palette -->
<div id="palette">
  <p>Choose Shapes</p>
  <div class="shape" style="width:100px;height:40px;"></div>
  <div class="shape" style="width:80px;height:50px;"></div>
  <div class="shape" style="width:120px;height:30px;"></div>
  <div class="shape" style="width:20px;height:60px;"></div>
  <div class="shape" style="width:40px;height:40px;"></div>
</div>

<!-- Game Area -->
<div id="gameWrapper">
  <div id="hud">
    <div class="header">
         <h4>How many blocks can you Stack ?  </h4>
         <p>Drop the blocks on the right, onto the darker blue rectangles</p>
    </div>
    Score: <span id="score">0</span>
    <button id="restart">Restart</button>
  </div>
  <canvas id="gameCanvas" class="gameCanvas"  ></canvas>
</div>

</div>

<div class="w-75">
    <h3 class="post_header">Stack Physics Stacking Puzzle</h3>
<p>Teach kids about the laws of physics by seeing how many blocks of varying shapes and sizes can be stacked without falling over.  Fun for grownups too!  Teachers trust Toy Theater to provide safe & effective educational games. Free to play, priceless for learning.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
const { Engine, Render, Runner, World, Bodies, Events, Mouse, MouseConstraint } = Matter;
const width = window.innerWidth - 150;
const height = window.innerHeight - 100;
// const width = 800 , height = 600;
const engine = Engine.create();
engine.world.gravity.y = 1;

const render = Render.create({
  canvas: document.getElementById('gameCanvas'),
  engine,
  options: {
    width,
    height,
    wireframes: false,
    background: '#4174cf'
  }
});
Render.run(render);
Runner.run(Runner.create(), engine);
const world = engine.world;

/* -------- Static boundaries -------- */
const wallColor = '#11182a';
const platformWidth = width * 0.5;
const platform = Bodies.rectangle(width/2, height - 20, platformWidth, 20,
  { isStatic:true, render:{ fillStyle: wallColor }});
const leftWall  = Bodies.rectangle(-10, height/2, 20, height,
  { isStatic:true, render:{ fillStyle: wallColor }});
const rightWall = Bodies.rectangle(width + 10, height/2, 20, height,
  { isStatic:true, render:{ fillStyle: wallColor }});
World.add(world, [platform, leftWall, rightWall]);

/* -------- Score -------- */
let score = 0;
const scoreEl = document.getElementById('score');

/* -------- Drag-and-drop from palette -------- */
const canvasRect = render.canvas.getBoundingClientRect();
const shapes = document.querySelectorAll('.shape');

shapes.forEach(shape => {
  shape.draggable = true;
  shape.addEventListener('dragstart', e => {
    e.dataTransfer.setData('w', shape.offsetWidth);
    e.dataTransfer.setData('h', shape.offsetHeight);
  });
});

// Allow drop on canvas
render.canvas.addEventListener('dragover', e => e.preventDefault());
render.canvas.addEventListener('drop', e => {
  e.preventDefault();
  const w = parseInt(e.dataTransfer.getData('w'));
  const h = parseInt(e.dataTransfer.getData('h'));
  const x = e.clientX - canvasRect.left;
  const y = e.clientY - canvasRect.top;
  addBox(x, y, w, h);
});

function addBox(x, y, w, h){
  const box = Bodies.rectangle(x, y, w, h, {
    restitution: 0.2,
    friction: 0.8,
    density: 0.001,
    render: { fillStyle: '#374d9d' }
  });
  World.add(world, box);
}

/* -------- Scoring rules -------- */
Events.on(engine, 'collisionStart', event => {
  event.pairs.forEach(pair => {
    const { bodyA, bodyB } = pair;
    if ((bodyA === platform && !bodyB.isStatic) ||
        (bodyB === platform && !bodyA.isStatic)) {
      const box = bodyA === platform ? bodyB : bodyA;
      if (!box.scored) {
        score++;
        box.scored = true;
        scoreEl.textContent = score;
      }
    }
  });
});

Events.on(engine, 'afterUpdate', () => {
  world.bodies.forEach(b => {
    if (!b.isStatic && b.position.y > height + 50) {
      if (!b.missed) {
        score = Math.max(0, score - 1);
        scoreEl.textContent = score;
        b.missed = true;
      }
      World.remove(world, b);
    }
  });
});

/* -------- Restart -------- */
document.getElementById('restart').onclick = () => {
  World.clear(world, true);
  World.add(world, [platform, leftWall, rightWall]);
  score = 0;
  scoreEl.textContent = score;
};
</script>
</body>
</html>
